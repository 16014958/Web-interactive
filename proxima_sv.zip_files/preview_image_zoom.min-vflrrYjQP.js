define(["require","exports","tslib","external/classnames","external/jquery.fs.zoomer","external/react","external/react-dom","jquery","modules/clean/photos/thumbnail_url_util","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/full_screen_helpers","modules/clean/react/image","modules/clean/react/previews/image_helpers","modules/clean/react/previews/preview_zoom_container","modules/clean/static_urls","modules/core/i18n","modules/core/notify","external/jquery.mousewheel"],function(e,o,t,i,r,n,l,a,s,m,u,d,p,f,c,v,h){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),i=t.__importDefault(i),r=t.__importDefault(r),n=t.__importStar(n),l=t.__importStar(l),a=t.__importDefault(a),p=t.__importStar(p);var z=(function(e){function o(o){var t=e.call(this,o)||this;return t.state={fullResolutionImageLoaded:!1,previewImageLoaded:!1,zoomerInitialized:!1,zoomOutDisabled:!0,zoomInDisabled:!1,dragDisabled:!0},t.onFullResolutionImageLoaded=function(){t.logFilePreviewEvent(m.EventType.FilePreviewDownloadSucceeded),t.logFilePreviewEvent(m.EventType.FilePreviewRenderSucceeded),t.setState({fullResolutionImageLoaded:!0}),t.props.setRenderStatusSuccess()},t.onFullResolutionImageError=function(){t.logFilePreviewEvent(m.EventType.FilePreviewDownloadFailed),t.props.onError&&t.props.onError()},t.onPreviewImageLoaded=function(){t.setState({previewImageLoaded:!0})},t.onZoomCallback=function(e){t.setState({zoomOutDisabled:e.atMinZoom,zoomInDisabled:e.atMaxZoom,dragDisabled:e.atMinZoom})},t.zoomToFit=function(){a.default(l.findDOMNode(t.zoomContainerRef.refs.zoomControlZoomOut)).trigger("zoomout")},t.onImageDoubleClick=function(e){if(t.state.fullResolutionImageLoaded&&!e.target.classList.contains("zoomer"))if(t.getZoomPercent()<100){var o=e.target.getBoundingClientRect();t.zoom100(e.pageX-o.left,e.pageY-o.top)}else t.zoomToFit()},t.fullResolutionImageUrl=s.fullSizeUrl(o.thumbnailUrlTmpl),t}return t.__extends(o,e),o.prototype.componentDidMount=function(){this.logFilePreviewEvent(m.EventType.FilePreviewSupportConfirmed),this.logFilePreviewEvent(m.EventType.FilePreviewDownloadAttempted),h.Notify.info(v._("Press esc to exit fullscreen"),3)},o.prototype.componentWillReceiveProps=function(e){if(e.thumbnailUrlTmpl!==this.props.thumbnailUrlTmpl){this.fullResolutionImageUrl=s.fullSizeUrl(e.thumbnailUrlTmpl);var o=e.filePreviewSession;this.logFilePreviewEvent(m.EventType.FilePreviewSupportConfirmed,o),this.logFilePreviewEvent(m.EventType.FilePreviewDownloadAttempted,o),this.setState({fullResolutionImageLoaded:!1,previewImageLoaded:!1}),this.destroyZoomer()}},o.prototype.componentDidUpdate=function(){!this.state.zoomerInitialized&&this.state.fullResolutionImageLoaded&&this.bindZoomer()},o.prototype.componentWillUnmount=function(){this.destroyZoomer(),a.default(window).off("resize.zommer"),h.Notify.clear()},o.prototype.logFilePreviewEvent=function(e,o){void 0===o&&(o=this.props.filePreviewSession),o&&o.recordEvent(e)},o.prototype.bindZoomer=function(){var e,o=this;(e=this.fullResolutionImage.getBoundingClientRect().width)&&this.state.fullResolutionImageLoaded&&(r.default(this.previewZoomer,{controls:{zoomIn:a.default(l.findDOMNode(this.zoomContainerRef.refs.zoomControlZoomIn)),zoomOut:a.default(l.findDOMNode(this.zoomContainerRef.refs.zoomControlZoomOut)),zoomLabel:a.default(l.findDOMNode(this.zoomContainerRef.refs.zoomLabel)),zoomLabelContainer:a.default(l.findDOMNode(this.zoomContainerRef.refs.zoomLabelContainer))},customClass:"preview-zoomer-style",retina:!1,onZoomCallback:this.onZoomCallback,startWidth:e,onContextMenu:this.props.onContextMenu}),null==this.fitToZoom&&(this.fitToZoom=this.getZoomPercent()),a.default(window).off("resize.zoomer").on("resize.zoomer",function(){r.default(o.previewZoomer,"resize"),o.fitToZoom=o.getZoomPercent()}),this.previewZoomer.off("mousewheel.zoom").on("mousewheel.zoom",function(e,t){e.preventDefault(),o.zoomScroll(t*e.deltaFactor)}),this.setState({zoomerInitialized:!0}))},o.prototype.destroyZoomer=function(){this.previewZoomer&&(r.default(this.previewZoomer,"destroy"),this.setState({zoomerInitialized:!1}))},o.prototype.getZoomPercent=function(){return parseFloat(a.default(l.findDOMNode(this.zoomContainerRef.refs.zoomLabel)).text())},o.prototype.zoom100=function(e,o){this.previewZoomer&&r.default(this.previewZoomer,"zoom100",e,o)},o.prototype.zoomScroll=function(e){this.previewZoomer&&r.default(this.previewZoomer,"zoomScroll",e)},o.prototype.render=function(){var e=this,o=this.props.thumbnailUrlTmpl,t=this.state,r=t.fullResolutionImageLoaded,l=t.previewImageLoaded;return n.createElement(f.PreviewZoomContainer,{fileCount:this.props.fileCount,fileIndex:this.props.fileIndex,renderZoomControls:r,onClose:u.exitFullScreen,onFlipNext:this.props.onFlipNext,onFlipPrevious:this.props.onFlipPrevious,containerClass:i.default({"zoomer-image":r,"preview-zoomer-loading":!r&&!l,"preview-zoom-thumbnail":!r&&l}),zoomOutCallback:this.zoomToFit,zoomInDisabled:this.state.zoomInDisabled,zoomOutDisabled:this.state.zoomOutDisabled,dragDisabled:this.state.dragDisabled,ref:function(o){return e.zoomContainerRef=o}},n.createElement("div",{ref:function(o){return e.previewZoomer=a.default(o)},className:i.default("preview-zoomer",{"preview-zoomer-loading":!l&&!r,"preview-zoomer-thumbnail-loaded":l&&!r}),style:{textAlign:"center"},onDoubleClick:this.onImageDoubleClick},r||l?null:n.createElement(d.Image,{alt:v._("Loading..."),className:"preview-zoomer-loader",src:c.static_url("/static/images/icons/white-on-dark-spinner-vflInam4o.gif"),srcHiRes:c.static_url("/static/images/icons/white-on-dark-spinner@2x-vfltkzAUn.gif")}),r?null:n.createElement("img",{className:"preview-zoom-thumbnail",onContextMenu:this.props.onContextMenu,alt:this.props.fileName,onLoad:this.onPreviewImageLoaded,sizes:p.IMG_SIZES_ATTR,src:p.getFallbackSrc(o),srcSet:p.getSrcSet(o)}),n.createElement("img",{alt:this.props.fileName,className:"preview-zoom",ref:function(o){return e.fullResolutionImage=o},src:this.fullResolutionImageUrl,onLoad:this.onFullResolutionImageLoaded,onError:this.onFullResolutionImageError,onContextMenu:this.props.onContextMenu})))},o})(n.Component);o.PreviewImageZoom=z});
//# sourceMappingURL=preview_image_zoom.min.js-vflx6ugyc.map